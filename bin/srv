#!/bin/zsh
#
# Manage nginx
#
# USAGE:
#
#   $ server command
#   # => start stop or reload server
ps cax | grep nginx > /dev/null
if [ $? -eq 0 ]; then
  pgrep nginx | grep `cat /usr/local/var/run/nginx.pid` > /dev/null
  if [ $? -eq 0 ]; then
    stat=1
  fi
else
  stat=0
fi


if [[ "$1" = "" ]]; then
  if [ $stat = 1 ]; then
    echo "Stopping server"
    launchctl unload ~/Library/LaunchAgents/blia.nginx.plist
  else
    echo "Starting server"
    launchctl load ~/Library/LaunchAgents/blia.nginx.plist
  fi
else
  case $1 in
    "r" )
      if [ $stat = 1 ]; then
        echo "Reloading server"
        launchctl unload ~/Library/LaunchAgents/blia.nginx.plist
        launchctl load ~/Library/LaunchAgents/blia.nginx.plist
      else
        echo "Starting server"
        launchctl load ~/Library/LaunchAgents/blia.nginx.plist
      fi
      ;;
  esac
fi
